<?xml version='1.0' encoding='UTF-8'?><!-- Published by JAX-WS RI at http://jax-ws.dev.java.net. 
  RI's version is Metro/2.3 (tags/2.3-7528; 2013-04-29T19:34:10+0000) JAXWS-RI/2.2.8 
  JAXWS/2.2 svn-revision#unknown. --><!-- Generated by JAX-WS RI at http://jax-ws.dev.java.net. 
  RI's version is Metro/2.3 (tags/2.3-7528; 2013-04-29T19:34:10+0000) JAXWS-RI/2.2.8 
  JAXWS/2.2 svn-revision#unknown. -->
<definitions
  xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
  xmlns:wsp="http://www.w3.org/ns/ws-policy" xmlns:wsp1_2="http://schemas.xmlsoap.org/ws/2004/09/policy"
  xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
  xmlns:tns="http://abhijitsarkar.name/webservices/jaxws/security/CalculatorSym/"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://schemas.xmlsoap.org/wsdl/"
  targetNamespace="http://abhijitsarkar.name/webservices/jaxws/security/CalculatorSym/"
  name="CalculatorSymService">
  <types>
    <xsd:schema>
      <xsd:import
        namespace="http://abhijitsarkar.name/webservices/jaxws/security/CalculatorSym/"
        schemaLocation="../xsd/calculator-sym.xsd" />
    </xsd:schema>
  </types>
  <message name="add">
    <part name="parameters" element="tns:add" />
  </message>
  <message name="addResponse">
    <part name="parameters" element="tns:addResponse" />
  </message>
  <portType name="CalculatorSym">
    <operation name="add">
      <input message="tns:add" />
      <output message="tns:addResponse" />
    </operation>
  </portType>
  <binding name="CalculatorSymBinding" type="tns:CalculatorSym">
    <soap:binding transport="http://schemas.xmlsoap.org/soap/http"
      style="document" />
    <operation name="add">
      <wsp:PolicyReference xmlns:wsp="http://www.w3.org/ns/ws-policy"
        URI="#SymmEncr" />
      <soap:operation soapAction="" />
      <input>
        <soap:body use="literal" />
      </input>
      <output>
        <wsp:PolicyReference xmlns:wsp="http://www.w3.org/ns/ws-policy"
          URI="#EncrBody" />
        <soap:body use="literal" />
      </output>
    </operation>
  </binding>
  <service name="CalculatorSymService">
    <port name="CalculatorSym" binding="tns:CalculatorSymBinding">
      <soap:address location="http://localhost:8080/calculator-sym/CalculatorSymService" />
    </port>
  </service>

  <!-- Symmetric encryption with a secret key. The embedded <sp:X509Token> assertion 
    says that a X.509 certificate will be used to protect the transmission of the secret 
    key (that is, encrypt the secret key for transmission), with the certificate identified 
    using a thumbprint reference (essentially a hash value). The certificate is derived 
    from the public key of the server. Client generation of the secret key is implicit 
    in the use of a <sp:SymmetricBinding> assertion with a <sp:X509Token> protection 
    token. Client will need a truststore with the server's public key in it in the form 
    of a certificate (used for encrypting the secret key generated by the client). It 
    will also need a keystore with the secret key in it. The server only needs a keystore 
    with a private key to decrypt the request and encrypt the response. The server is 
    not challenging the client so it does not need a truststore with the client's public 
    key in it. -->

  <!-- http://www.ibm.com/developerworks/java/library/j-jws17/index.html -->
  <wsp:Policy wsu:Id="SymmEncr"
    xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
    xmlns:wsp="http://www.w3.org/ns/ws-policy" xmlns:wsaw="http://www.w3.org/2006/05/addressing/wsdl"
    xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702">
    <sp:SymmetricBinding>
      <wsp:Policy>
        <sp:ProtectionToken>
          <wsp:Policy>
            <sp:X509Token
              sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never">
              <wsp:Policy>
                <sp:RequireThumbprintReference />
                <sp:WssX509V3Token10 />
              </wsp:Policy>
            </sp:X509Token>
          </wsp:Policy>
        </sp:ProtectionToken>
        <!-- A timestamp will be included with every message, useful against replay 
          attacks -->
        <sp:IncludeTimestamp />
        <!-- Signing will be done on the entire header or body of the message, rather 
          than on some nested element, useful against attacks where part of the message is 
          changed -->
        <sp:OnlySignEntireHeadersAndBody />
        <!-- Algorithm used for signing -->
        <sp:AlgorithmSuite>
          <wsp:Policy>
            <sp:Basic128Rsa15 />
          </wsp:Policy>
        </sp:AlgorithmSuite>
      </wsp:Policy>
    </sp:SymmetricBinding>
    <!-- I don't understand this element but it seems to be present in every symmetric 
      example so must be useful :) -->
    <sp:Wss11>
      <wsp:Policy>
        <sp:MustSupportRefKeyIdentifier />
        <sp:MustSupportRefThumbprint />
        <sp:MustSupportRefEncryptedKey />
      </wsp:Policy>
    </sp:Wss11>
    <!-- GlassFish seems to consider an ear deployment as JSR-109 compliant. It will 
      ignore any attempt to specify a custom keystore, either packaged with the app, or 
      as absolute location or a CallbackHandler. Thus the location can only point to a 
      keystore that's on classpath and is a copy of GlassFish's keystore or as the absolute 
      path to the GlassFish's keystore. In this case, the keystore is copied from GlassFish. 
      It's beyond me why they even require the location if they are going to ignore it 
      anyway. -->
    <wsss:KeyStore xmlns:wsss="http://schemas.sun.com/2006/03/wss/server"
      wspp:visibility="private" location="keystore.jks" storepass="changeit"
      alias="calcsym-server" keypass="changeit" type="JKS"
      xmlns:wspp="http://java.sun.com/xml/ns/wsit/policy" />
  </wsp:Policy>

  <!-- The SOAP Body will be encrypted using the secret key -->
  <wsp:Policy wsu:Id="EncrBody"
    xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
    xmlns:wsp="http://www.w3.org/ns/ws-policy" xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702">
    <sp:EncryptedParts>
      <sp:Body />
    </sp:EncryptedParts>
  </wsp:Policy>
</definitions>